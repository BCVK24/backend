<h2>VK Audio Clean (ML)</h2>

Данный репозиторий предоставляет интерфейс для взаимодействия с ASR-моделями GigaAM (Сбер) и Whisper (OpenAI). Интерфейс для взаимодействия из сторонних модулей находится в классе `ASRInference` в файле `asr_inference.py`. Реализация приватных функций для работы с моделями находится в классе `ModelAbstract` в файле `model_abstract.py`

Класс `ASRInference` состоит из 3-х публичных методов: `forced_align`, `transcribe`: <br><br>Метод `transcribe` нужен для транскрибации wav-аудиозиписи, на вход он получает название файла, а на выходе возвращает список токенов всей аудиозаписи либо ее сегментов. <br><br>Метод `forced_align` используется для получения временного распределения токенов на аудиозаписи, на вход он получает название файла, на выходе метод выдаёт список списков, где каждый подсписок состоит из токена, времени начала произношения этого токена на аудиозаписи, время конца.<br><br>

Класс `FilterAbstract` используется для фильтрации списка выравненных по времени токенов (выхода функции `forced_align`), выводит список списков, где каждый подсписок является списком из 4-х элементов: токена, временной метки начала, временной метки конца, bool-значения, говорящего о том, является ли токен мусорным.

<br>

При использования класса ASRInference необходимо передать название модели (str), которую вы хотите использовать (`GigaAM`, `Whisper` и тд.), а также конфиг (dict). Также перед передачей wav-файла в ASRInference, необходимо предобработать его с помощью метода `convert_wav` из `utils.py`, который преобразует wav-файл из одного канала в другой, а также меняет герцовку.

```
from asr_inference import ASRInference
from filter_abstract import FilterAbstract
from utils import convert_wav


SPEECH_FILE = "/media/disk2/ml_rewrite/misc.mp3"
speech = convert_wav(SPEECH_FILE)

# Получение выравнивания с помощью ASR-модели
model_config = {
            'model_weights': '../ml/ctc_model_weights.ckpt',
            'device': 'cpu', 'batch_size': 1, 'model_type': 'CTC',
            'model_config': './conf/ctc_model_config.yaml'}

asr = ASRInference('GigaAM', model_config)
alignments = asr.forced_align(speech)

# Фильтрация выравнивания с помощью BERT-модели
filter_model_config = {'model_path': '/media/disk2/ruslan_models/ruBert-base_again_100epoch_without_punctuation/checkpoint-215200', 
                       'device': 'cuda'}

bert = FilterAbstract(model_name='cointegrated/rubert-tiny2',
                      model_config=filter_model_config)

alignments_filter = bert.filter(alignments)

# Вывод результата фильтрации
print(alignments_filter)
```

Этот пример выдаёт следующий список списков выравнивания:

```[['вроде', 0.0799375, 0.35975, True], ['бы', 0.4396875, 0.519625, True], ['все', 0.6795, 0.7994375, False], ['понятно', 0.9193125, 1.3590625, False], ['таким', 2.2784375, 2.55825, True], ['образом', 2.678125, 3.077875, True], ['мы', 3.1578125, 3.23775, False], ['можем', 3.3576875, 3.5975, False], ['понять', 3.7174375, 4.0371875, False], ['что', 4.157125, 4.397, False], ['вообще', 5.8759375, 6.2756875, False], ['то', 6.4355625, 6.5555, False], ['то', 7.315, 8.6740625, True], ['есть', 8.754, 8.953875, True], ['все', 9.07375, 9.1936875, False], ['понятно', 9.313625, 9.7533125, False], ['как', 10.9925, 11.152375, True], ['бы', 11.2323125, 11.31225, True], ['мы', 11.4321875, 11.512125, False], ['это', 11.5920625, 11.712, False], ['сделали', 11.831875, 13.2309375, False], ['пипец', 13.47075, 13.9105, True], ['капец', 14.7099375, 15.149625, True], ['офигеть', 15.74925, 16.588625, True], ['ни', 16.8684375, 16.988375, False], ['хрена', 17.0683125, 17.8678125, False], ['нифига', 18.49221875, 19.09121875, True], ['себе', 19.21096875, 20.24928125, True], ['наверное', 20.528781249999998, 21.04796875, True], ['все', 21.167781249999997, 21.28753125, False], ['готово', 21.40734375, 21.72684375, False], ['ах', 22.64528125, 23.00471875, True], ['ух', 23.48390625, 23.84334375, True], ['ух', 24.362468749999998, 24.681906249999997, True], ['ха', 25.60040625, 26.11953125, False], ['ай', 26.59871875, 26.91821875, True], ['ой', 27.03803125, 27.317531250000002, True], ['ну', 27.39740625, 28.07628125, True], ['ага', 28.19609375, 28.95484375, True], ['эй', 29.074656249999997, 29.473968749999997, True], ['фу', 29.63371875, 30.07296875, True], ['бр', 30.23271875, 30.55221875, False], ['тьфу', 31.071343749999997, 32.86834375, True], ['урам', 32.98815625, 33.86671875, False], ['ищ', 33.98646875, 34.34590625, False], ['эген', 34.904968749999995, 35.74359375, False], ['ба', 35.90334375, 36.582218749999996, True], ['натя', 36.970343750000005, 37.67909375000001, False]]```